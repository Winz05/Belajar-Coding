<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

</body>
<script>
    let product = [
        { id: 1, name: "Apel", price: 10000, stock: 10 },
        { id: 2, name: "Jeruk", price: 15000, stock: 15 },
        { id: 3, name: "Semangka", price: 20000, stock: 20 }
    ]

    let keranjangBelanja = [
        { id: 1, quantity: 0 },
        { id: 2, quantity: 0 },
        { id: 3, quantity: 0 }
    ]


    alert(`Welcome To Purwadhika Mart`)
    PilihanMenu()

    function PilihanMenu() {
        let daftarMenu = "Purwadhika Mart \n"

        for (let i = 0; i < product.length; i++) {
            daftarMenu += (`${product[i].id}. ${product[i].name} - Price: Rp. ${product[i].price.toLocaleString()} - Stock: ${product[i].stock} \n`)
        }

        let pilihMenu = parseInt(prompt(`${daftarMenu} \n\n Silahkan Pilih Nomor Product yang ingin Dibeli: `))
        while (isNaN(pilihMenu) || pilihMenu < 1 || pilihMenu > product.length) {
            alert(`Invalid!, Silahkan Input Ulang`)
            pilihMenu = parseInt(prompt(`${daftarMenu} \n\n Silahkan Pilih Nomor Product yang ingin Dibeli: `))
        }

        let stockName = product[pilihMenu - 1].name
        let stockQty = product[pilihMenu - 1].stock
        let quantity = parseInt(prompt(`Barang yang ingin Anda Beli Adalah: \n\n Product: ${stockName} || Stock Saat ini: ${stockQty} \n\n Silahkan Masukkan Jumlah Product yang ingin Dibeli: `))
        while (isNaN(quantity) || quantity < 1 || quantity > stockQty) {
            alert(`Invalid!, Silahkan Input Ulang`)
            quantity = parseInt(prompt(`Barang yang ingin Anda Beli Adalah: \n\n Product: ${stockName} || Stock Saat ini: ${stockQty} \n\n Silahkan Masukkan Jumlah Product yang ingin Dibeli: `))
        }

        product[pilihMenu - 1].stock = stockQty - quantity
        keranjangBelanja[pilihMenu - 1].quantity += quantity
        alert(`Product Berhasil Dimasukkan Kedalam Keranjang Belanja Anda`)

        return beforeCheckOut()
    }

    function beforeCheckOut() {
        let menuCheckOut = parseInt(prompt(`Silahkan Pilih Menu:\n1. CheckOut \n2. Select Product `))
        while (isNaN(menuCheckOut) || menuCheckOut < 1 || menuCheckOut > 2) {
            alert(`Invalid!, Silahkan Input Ulang`)
            menuCheckOut = parseInt(prompt(`Silahkan Pilih Menu:\n1. CheckOut \n2. Select Product `))
        }

        let totalBelanja = 0
        let cart = ""
        for (let i = 0; i < keranjangBelanja.length; i++) {
            if (keranjangBelanja[i].quantity > 0) {
                totalBelanja += keranjangBelanja[i].quantity * product[i].price
                cart += (` -> Product: ${product[i].name} || Price: Rp. ${(product[i].price).toLocaleString()} || Quantity: ${(keranjangBelanja[i].quantity)} \n Dengan Total Belanja Sebesar: Rp. ${(keranjangBelanja[i].quantity * product[i].price).toLocaleString()}\n`)
            }
        }

        if (menuCheckOut === 1) {
            let uangBelanja = parseInt(prompt(`Keranjang Belanja Anda Saat Ini Adalah:\n ${cart} \n Maka Total Biaya Belanja Anda Sebesar Rp. ${totalBelanja.toLocaleString()} \n Silahkan Masukkan Uang Anda: `))
            let uangKembali = uangBelanja - totalBelanja
            while (uangKembali < 0 || isNaN(uangBelanja)) {
                alert(`Transaksi Gagal! Jumlah Uang Anda Kurang Rp. ${uangKembali.toLocaleString()} `)
                uangBelanja = parseInt(prompt(`Keranjang Belanja Anda Saat Ini Adalah:\n ${cart} \n Maka Total Biaya Belanja Anda Sebesar Rp. ${totalBelanja.toLocaleString()} \n Silahkan Masukkan Uang Anda: `))
                uangKembali = uangBelanja - totalBelanja
            }

            if (uangKembali === 0) {
                return alert(`Terima Kasih Telah Berbelanja di Toko Kami`)
            } else {
                return alert(`Uang Kembalian Anda Rp. ${uangKembali.toLocaleString()}. Terima Kasih Telah Berbelanja di Toko Kami`)
            }
        } else {
            return PilihanMenu();
        }
    }
</script>

</html>